<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
</head>
<body>

    <header>
        <h1 id="welcome">

        </h1>
    </header>

    <main id="chat">

    </main>
    
    <input type="text" placeholder="Message" id="message"><input type="button" value="Send">

    <script>
        alert("username: " + localStorage.getItem("username") + "\nroom: " + localStorage.getItem("room"))

        document.getElementById("welcome").innerText = `${localStorage.getItem("room")}`

        const socket = new WebSocket(
            `wss://${window.location.host}/chat?username=${localStorage.getItem("username")}&room=${localStorage.getItem("room")}}`
        )

        socket.onmessage = (message) => {
            let data = JSON.parse(message.data);
            let e = document.createElement("div");
            e.innerHTML = `<h2>${data.username}</h2><p>${data.message}</p>`;
            if (data.type == "new-user") {
                e.classList.add("new")
            } else if (data.type == "left-user") {
                e.classList.add("gone")
            } else {
                e.classList.add("message")
            }
            document.getElementById("chat").append(e);
        }

        function send() {
            socket.send(document.getElementById("message").value)
        }
    </script>
</body>
</html>